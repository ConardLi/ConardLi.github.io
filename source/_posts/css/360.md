---
title: çœ‹å®Œè¿™ç¯‡ï¼Œä½ ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ª360åº¦å…¨æ™¯æ’ä»¶
category: æ ·å¼å’Œæ•ˆæœ
tag: 
- æ ·å¼å’Œæ•ˆæœ
- Three.js
- 3D
date: 2019-05-05
---


å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ [ä¸–å¥‡](https://mp.weixin.qq.com/s?__biz=Mzk0MDMwMzQyOA==&mid=2247493407&idx=1&sn=41b8782a3bdc75b211206b06e1929a58&chksm=c2e11234f5969b22a0d7fd50ec32be9df13e2caeef186b30b5d653836b0725def8ccd58a56cf#rd)ï¼Œç¬”å [ConardLi](https://mp.weixin.qq.com/s?__biz=Mzk0MDMwMzQyOA==&mid=2247493407&idx=1&sn=41b8782a3bdc75b211206b06e1929a58&chksm=c2e11234f5969b22a0d7fd50ec32be9df13e2caeef186b30b5d653836b0725def8ccd58a56cf#rd)ã€‚
 
## å¯¼è¯»

æœ¬æ–‡ä»ç»˜å›¾åŸºç¡€å¼€å§‹è®²èµ·ï¼Œè¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨`Three.js`å¼€å‘ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„å…¨æ™¯æ’ä»¶ã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æ’ä»¶çš„æ•ˆæœï¼š


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a83669b12c799b~tplv-t2oaga2asx-image.image)


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a83673fb64ade6~tplv-t2oaga2asx-image.image)

å¦‚æœä½ å¯¹`Three.js`å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œæˆ–è€…ä½ æƒ³è·³è¿‡åŸºç¡€ç†è®ºï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥ä»[å…¨æ™¯é¢„è§ˆ](#å…¨æ™¯é¢„è§ˆ)å¼€å§‹çœ‹èµ·ã€‚

æœ¬é¡¹ç›®çš„`github`åœ°å€ï¼šhttps://github.com/ConardLi/tpanorama


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a8367f8518893a~tplv-t2oaga2asx-image.image)

## ä¸€ã€ç†æ¸…å…³ç³»

### 1.1 OpenGL


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a8368a487f7ec0~tplv-t2oaga2asx-image.image)

`OpenGL`æ˜¯ç”¨äºæ¸²æŸ“`2Dã€3D`é‡å›¾å½¢çš„è·¨è¯­è¨€ã€è·¨å¹³å°çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£`ï¼ˆAPIï¼‰`ã€‚

è¿™ä¸ªæ¥å£ç”±è¿‘`350`ä¸ªä¸åŒçš„å‡½æ•°è°ƒç”¨ç»„æˆï¼Œç”¨æ¥ä»ç®€å•çš„å›¾å½¢æ¯”ç‰¹ç»˜åˆ¶å¤æ‚çš„ä¸‰ç»´æ™¯è±¡ã€‚

`OpenGL ES` æ˜¯` OpenGL `ä¸‰ç»´å›¾å½¢` API `çš„å­é›†ï¼Œé’ˆå¯¹æ‰‹æœºã€`PDA`å’Œæ¸¸æˆä¸»æœºç­‰åµŒå…¥å¼è®¾å¤‡è€Œè®¾è®¡ã€‚

åŸºäº`OpenGL`ï¼Œä¸€èˆ¬ä½¿ç”¨`C`æˆ–`Cpp`å¼€å‘ï¼Œå¯¹å‰ç«¯å¼€å‘è€…æ¥è¯´ä¸æ˜¯å¾ˆå‹å¥½ã€‚

### 1.2 WebGL

`WebGL`æŠŠ`JavaScript`å’Œ`OpenGL ES 2.0`ç»“åˆåœ¨ä¸€èµ·ï¼Œä»è€Œä¸ºå‰ç«¯å¼€å‘è€…æä¾›äº†ä½¿ç”¨`JavaScript`ç¼–å†™`3D`æ•ˆæœçš„èƒ½åŠ›ã€‚

`WebGL`ä¸º`HTML5 Canvas`æä¾›ç¡¬ä»¶`3D`åŠ é€Ÿæ¸²æŸ“ï¼Œè¿™æ ·`Web`å¼€å‘äººå‘˜å°±å¯ä»¥å€ŸåŠ©ç³»ç»Ÿæ˜¾å¡æ¥åœ¨æµè§ˆå™¨é‡Œæ›´æµç•…åœ°å±•ç¤º`3D`åœºæ™¯å’Œæ¨¡å‹äº†ï¼Œè¿˜èƒ½åˆ›å»ºå¤æ‚çš„å¯¼èˆªå’Œæ•°æ®è§†è§‰åŒ–ã€‚

### 1.3 Canvas


`Canvas`æ˜¯ä¸€ä¸ªå¯ä»¥è‡ªç”±åˆ¶å®šå¤§å°çš„çŸ©å½¢åŒºåŸŸï¼Œå¯ä»¥é€šè¿‡`JavaScript`å¯ä»¥å¯¹çŸ©å½¢åŒºåŸŸè¿›è¡Œæ“ä½œï¼Œå¯ä»¥è‡ªç”±çš„ç»˜åˆ¶å›¾å½¢ï¼Œæ–‡å­—ç­‰ã€‚

ä¸€èˆ¬ä½¿ç”¨`Canvas`éƒ½æ˜¯ä½¿ç”¨å®ƒçš„`2d`çš„`context`åŠŸèƒ½ï¼Œè¿›è¡Œ`2d`ç»˜å›¾ï¼Œè¿™æ˜¯å…¶æœ¬èº«çš„èƒ½åŠ›ã€‚

å’Œè¿™ä¸ªç›¸å¯¹çš„ï¼Œ`WebGL`æ˜¯ä¸‰ç»´ï¼Œå¯ä»¥æç”»`3D`å›¾å½¢ï¼Œ`WebGL`ï¼Œæƒ³è¦åœ¨æµè§ˆå™¨ä¸Šè¿›è¡Œå‘ˆç°ï¼Œå®ƒå¿…é¡»éœ€è¦ä¸€ä¸ªè½½ä½“ï¼Œè¿™ä¸ªè½½ä½“å°±æ˜¯`Canvas`ï¼ŒåŒºåˆ«äºä¹‹å‰çš„`2dcontext`ï¼Œè¿˜å¯ä»¥ä»`Canvas`ä¸­è·å–`webglcontext`ã€‚


### 1.4 Three.js


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a8369190c72cbd~tplv-t2oaga2asx-image.image)

æˆ‘ä»¬å…ˆæ¥ä»å­—é¢æ„æ€ç†è§£ä¸‹ï¼š`Three`ä»£è¡¨`3D`ï¼Œ`js`ä»£è¡¨`JavaScript`ï¼Œå³ä½¿ç”¨`JavaScript`æ¥å¼€å‘`3D`æ•ˆæœã€‚

`Three.js`æ˜¯ä½¿ç”¨`JavaScript `å¯¹ `WebGL`æ¥å£è¿›è¡Œå°è£…ä¸ç®€åŒ–è€Œå½¢æˆçš„ä¸€ä¸ªæ˜“ç”¨çš„`3D`åº“ã€‚

ç›´æ¥ä½¿ç”¨`WebGL`è¿›è¡Œå¼€å‘å¯¹äºå¼€å‘è€…æ¥è¯´æˆæœ¬ç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œå®ƒéœ€è¦ä½ æŒæ¡è¾ƒå¤šçš„è®¡ç®—æœºå›¾å½¢å­¦çŸ¥è¯†ã€‚

`Three.js`åœ¨ä¸€å®šç¨‹åº¦ä¸Šç®€åŒ–äº†ä¸€äº›è§„èŒƒå’Œéš¾ä»¥ç†è§£çš„æ¦‚å¿µï¼Œå¯¹å¾ˆå¤š`API`è¿›è¡Œäº†ç®€åŒ–ï¼Œè¿™å¤§å¤§é™ä½äº†å­¦ä¹ å’Œå¼€å‘ä¸‰ç»´æ•ˆæœæˆæœ¬ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸€ä¸‹ä½¿ç”¨`Three.js`å¿…é¡»è¦çŸ¥é“çš„çŸ¥è¯†ã€‚

## äºŒã€Three.jsåŸºç¡€çŸ¥è¯†

ä½¿ç”¨`Three.js`ç»˜åˆ¶ä¸€ä¸ªä¸‰ç»´æ•ˆæœï¼Œè‡³å°‘éœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

- åˆ›å»ºä¸€ä¸ªå®¹çº³ä¸‰ç»´ç©ºé—´çš„åœºæ™¯ â€” `Sence`

- å°†éœ€è¦ç»˜åˆ¶çš„å…ƒç´ åŠ å…¥åˆ°åœºæ™¯ä¸­ï¼Œå¯¹å…ƒç´ çš„å½¢çŠ¶ã€ææ–™ã€é˜´å½±ç­‰è¿›è¡Œè®¾ç½®

- ç»™å®šä¸€ä¸ªè§‚å¯Ÿåœºæ™¯çš„ä½ç½®ï¼Œä»¥åŠè§‚å¯Ÿè§’åº¦ï¼Œæˆ‘ä»¬ç”¨ç›¸æœºå¯¹è±¡ï¼ˆ`Camera`ï¼‰æ¥æ§åˆ¶

- å°†ç»˜åˆ¶å¥½çš„å…ƒç´ ä½¿ç”¨æ¸²æŸ“å™¨ï¼ˆ`Renderer`ï¼‰è¿›è¡Œæ¸²æŸ“ï¼Œæœ€ç»ˆå‘ˆç°åœ¨æµè§ˆå™¨ä¸Š

æ‹¿ç”µå½±æ¥ç±»æ¯”çš„è¯ï¼Œåœºæ™¯å¯¹åº”äºæ•´ä¸ªå¸ƒæ™¯ç©ºé—´ï¼Œç›¸æœºæ˜¯æ‹æ‘„é•œå¤´ï¼Œæ¸²æŸ“å™¨ç”¨æ¥æŠŠæ‹æ‘„å¥½çš„åœºæ™¯è½¬æ¢æˆèƒ¶å·ã€‚

### 2.1 åœºæ™¯

åœºæ™¯å…è®¸ä½ è®¾ç½®å“ªäº›å¯¹è±¡è¢«`three.js`æ¸²æŸ“ä»¥åŠæ¸²æŸ“åœ¨å“ªé‡Œã€‚

æˆ‘ä»¬åœ¨åœºæ™¯ä¸­æ”¾ç½®å¯¹è±¡ã€ç¯å…‰å’Œç›¸æœºã€‚

å¾ˆç®€å•ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ª`Scene`çš„å®ä¾‹å³å¯ã€‚

```js
 _scene = new Scene();
```
### 2.2 å…ƒç´ 

æœ‰äº†åœºæ™¯ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±éœ€è¦åœºæ™¯é‡Œåº”è¯¥å±•ç¤ºå“ªäº›ä¸œè¥¿ã€‚


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a83684ac2a3d14~tplv-t2oaga2asx-image.image)

ä¸€ä¸ªå¤æ‚çš„ä¸‰ç»´åœºæ™¯å¾€å¾€å°±æ˜¯ç”±éå¸¸å¤šçš„å…ƒç´ æ­å»ºèµ·æ¥çš„ï¼Œè¿™äº›å…ƒç´ å¯èƒ½æ˜¯ä¸€äº›è‡ªå®šä¹‰çš„å‡ ä½•ä½“ï¼ˆ`Geometry`ï¼‰ï¼Œæˆ–è€…å¤–éƒ¨å¯¼å…¥çš„å¤æ‚æ¨¡å‹ã€‚

`Three.js` ä¸ºæˆ‘ä»¬æä¾›äº†éå¸¸å¤šçš„`Geometry`ï¼Œä¾‹å¦‚`SphereGeometry`ï¼ˆçƒä½“ï¼‰ã€	`TetrahedronGeometry`ï¼ˆå››é¢ä½“ï¼‰ã€`TorusGeometry`ï¼ˆåœ†ç¯ä½“ï¼‰ç­‰ç­‰ã€‚

åœ¨`Three.js`ä¸­ï¼Œæè´¨ï¼ˆ`Material`ï¼‰å†³å®šäº†å‡ ä½•å›¾å½¢å…·ä½“æ˜¯ä»¥ä»€ä¹ˆå½¢å¼å±•ç°çš„ã€‚å®ƒåŒ…æ‹¬äº†ä¸€ä¸ªå‡ ä½•ä½“å¦‚ä½•å½¢çŠ¶ä»¥å¤–çš„å…¶ä»–å±æ€§ï¼Œä¾‹å¦‚è‰²å½©ã€çº¹ç†ã€é€æ˜åº¦ç­‰ç­‰ï¼Œ`Material`å’Œ`Geometry`æ˜¯ç›¸è¾…ç›¸æˆçš„ï¼Œå¿…é¡»ç»“åˆä½¿ç”¨ã€‚

ä¸‹é¢çš„ä»£ç æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªé•¿æ–¹ä½“ä½“ï¼Œèµ‹äºˆå®ƒåŸºç¡€ç½‘å­”ææ–™ï¼ˆ`MeshBasicMaterial`ï¼‰

```js
    var geometry = new THREE.BoxGeometry(200, 100, 100);
    var material = new THREE.MeshBasicMaterial({ color: 0x645d50 });
    var mesh = new THREE.Mesh(geometry, material);
            _scene.add(mesh);
```

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836975dfc07eb~tplv-t2oaga2asx-image.image)

èƒ½ä»¥è¿™ä¸ªè§’åº¦çœ‹åˆ°å‡ ä½•ä½“å®é™…ä¸Šæ˜¯ç›¸æœºçš„åŠŸåŠ³ï¼Œè¿™ä¸ªæˆ‘ä»¬[ä¸‹é¢çš„ç« èŠ‚](#ç›¸æœº)å†ä»‹ç»ï¼Œè¿™è®©æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªå‡ ä½•ä½“çš„è½®å»“ï¼Œä½†æ˜¯æ„Ÿè§‰æ€ªæ€ªçš„ï¼Œè¿™å¹¶ä¸åƒä¸€ä¸ªå‡ ä½•ä½“ï¼Œå®é™…ä¸Šæˆ‘ä»¬è¿˜éœ€è¦ä¸ºå®ƒæ·»åŠ å…‰ç…§å’Œé˜´å½±ï¼Œè¿™ä¼šè®©å‡ ä½•ä½“çœ‹èµ·æ¥æ›´çœŸå®ã€‚


åŸºç¡€ç½‘å­”ææ–™ï¼ˆ`MeshBasicMaterial`ï¼‰ä¸å—å…‰ç…§å½±å“çš„ï¼Œå®ƒä¸ä¼šäº§ç”Ÿé˜´å½±ï¼Œä¸‹é¢æˆ‘ä»¬ä¸ºå‡ ä½•ä½“æ¢ä¸€ç§å—å…‰ç…§å½±å“çš„ææ–™ï¼šç½‘æ ¼æ ‡å‡†æè´¨(`Standard Material`)ï¼Œå¹¶ä¸ºå®ƒæ·»åŠ ä¸€äº›å…‰ç…§ï¼š

```js
    var geometry = new THREE.BoxGeometry(200, 100, 100);
    var material = new THREE.MeshStandardMaterial({ color: 0x645d50 });
    var mesh = new THREE.Mesh(geometry, material);
    _scene.add(mesh);
    // åˆ›å»ºå¹³è¡Œå…‰-ç…§äº®å‡ ä½•ä½“
    var directionalLight = new THREE.DirectionalLight(0xffffff, 1);
     directionalLight.position.set(-4, 8, 12);
    _scene.add(directionalLight);
    // åˆ›å»ºç¯å¢ƒå…‰
    var ambientLight = new THREE.AmbientLight(0xffffff);
    _scene.add(ambientLight);
```


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a8369a379a72a3~tplv-t2oaga2asx-image.image)

æœ‰äº†å…‰çº¿çš„æ¸²æŸ“ï¼Œè®©å‡ ä½•ä½“çœ‹èµ·æ¥æ›´å…·æœ‰`3D`æ•ˆæœï¼Œ`Three.js`ä¸­å…‰æºæœ‰å¾ˆå¤šç§ï¼Œæˆ‘ä»¬ä¸Šé¢ä½¿ç”¨äº†ç¯å¢ƒå…‰(`AmbientLight`)å’Œå¹³è¡Œå…‰(`DirectionalLight`)ã€‚

ç¯å¢ƒå…‰ä¼šå¯¹åœºæ™¯ä¸­çš„æ‰€æœ‰ç‰©å“è¿›è¡Œé¢œè‰²æ¸²æŸ“ã€‚

å¹³è¡Œå…‰ä½ å¯ä»¥è®¤ä¸ºåƒå¤ªé˜³å…‰ä¸€æ ·ï¼Œä»æè¿œå¤„å°„å‘åœºæ™¯ä¸­çš„å…‰ã€‚å®ƒå…·æœ‰æ–¹å‘æ€§ï¼Œä¹Ÿå¯ä»¥å¯åŠ¨ç‰©ä½“å¯¹å…‰çš„åå°„æ•ˆæœã€‚

é™¤äº†è¿™ä¸¤ç§å…‰ï¼Œ`Three.js`è¿˜æä¾›äº†å…¶ä»–å‡ ç§å…‰æºï¼Œå®ƒä»¬é€‚ç”¨äºä¸åŒæƒ…å†µä¸‹å¯¹ä¸åŒæè´¨çš„æ¸²æŸ“ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ã€‚

### 2.3 åæ ‡ç³»

åœ¨è¯´ç›¸æœºä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥äº†è§£ä¸€ä¸‹åæ ‡ç³»çš„æ¦‚å¿µï¼š

åœ¨ä¸‰ç»´ä¸–ç•Œä¸­ï¼Œåæ ‡å®šä¹‰äº†ä¸€ä¸ªå…ƒç´ æ‰€å¤„äºä¸‰ç»´ç©ºé—´çš„ä½ç½®ï¼Œåæ ‡ç³»çš„åŸç‚¹å³åæ ‡çš„åŸºå‡†ç‚¹ã€‚

æœ€å¸¸ç”¨çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨è·ç¦»åŸç‚¹çš„ä¸‰ä¸ªé•¿åº¦ï¼ˆè·ç¦»`x`è½´ã€è·ç¦»`y`è½´ã€è·ç¦»`z`è½´ï¼‰æ¥å®šä¹‰ä¸€ä¸ªä½ç½®ï¼Œè¿™å°±æ˜¯ç›´è§’åæ ‡ç³»ã€‚

åœ¨åˆ¤å®šåæ ‡ç³»æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨å¤§æ‹‡æŒ‡ã€é£ŸæŒ‡å’Œä¸­æŒ‡ï¼Œå¹¶äº’ä¸º`90`åº¦ã€‚å¤§æ‹‡æŒ‡ä»£è¡¨`X`è½´ï¼Œé£ŸæŒ‡ä»£è¡¨`Y`è½´ï¼Œä¸­æŒ‡ä»£è¡¨`Z`è½´ã€‚

è¿™å°±äº§ç”Ÿäº†ä¸¤ç§åæ ‡ç³»ï¼šå·¦æ‰‹åæ ‡ç³»å’Œå³æ‰‹åæ ‡ç³»ã€‚


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a8369f55b3053a~tplv-t2oaga2asx-image.image)

`Three.js`ä¸­ä½¿ç”¨çš„åæ ‡ç³»å³å³æ‰‹åæ ‡ç³»ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­æ·»åŠ ä¸€ä¸ªåæ ‡ç³»ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°å…ƒç´ å¤„äºä»€ä¹ˆä½ç½®ï¼š

```js
 var axisHelper = new THREE.AxisHelper(600);
 _scene.add(axisHelper);
```


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836a2491e3167~tplv-t2oaga2asx-image.image)

å…¶ä¸­çº¢è‰²ä»£è¡¨`X`è½´ï¼Œç»¿è‰²ä»£è¡¨`Y`è½´ï¼Œè“è‰²ä»£è¡¨`Z`è½´ã€‚

### 2.4 ç›¸æœº

ä¸Šé¢çœ‹åˆ°çš„å‡ ä½•ä½“çš„æ•ˆæœï¼Œå¦‚æœä¸åˆ›å»ºä¸€ä¸ªç›¸æœº(`Camera`)ï¼Œæ˜¯ä»€ä¹ˆä¹Ÿçœ‹ä¸åˆ°çš„ï¼Œå› ä¸ºé»˜è®¤çš„è§‚å¯Ÿç‚¹åœ¨åæ ‡è½´åŸç‚¹ï¼Œå®ƒå¤„äºå‡ ä½•ä½“çš„å†…éƒ¨ã€‚

ç›¸æœº(`Camera`)æŒ‡å®šäº†æˆ‘ä»¬åœ¨ä»€ä¹ˆä½ç½®è§‚å¯Ÿè¿™ä¸ªä¸‰ç»´åœºæ™¯ï¼Œä»¥åŠä»¥ä»€ä¹ˆæ ·çš„è§’åº¦è¿›è¡Œè§‚å¯Ÿã€‚

#### 2.4.1 ä¸¤ç§ç›¸æœºçš„åŒºåˆ«

ç›®å‰`Three.js`æä¾›äº†å‡ ç§ä¸åŒçš„ç›¸æœºï¼Œæœ€å¸¸ç”¨çš„ï¼Œä¹Ÿæ˜¯ä¸‹é¢æ’ä»¶ä¸­ä½¿ç”¨çš„ä¸¤ç§ç›¸æœºæ˜¯ï¼š`PerspectiveCamera`ï¼ˆé€è§†ç›¸æœºï¼‰ã€ `OrthographicCamera`ï¼ˆæ­£äº¤æŠ•å½±ç›¸æœºï¼‰ã€‚


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836a67a13fd7c~tplv-t2oaga2asx-image.image)

ä¸Šé¢çš„å›¾å¾ˆæ¸…æ¥šçš„è§£é‡Šäº†ä¸¤ç§ç›¸æœºçš„åŒºåˆ«ï¼š

å³ä¾§æ˜¯ `OrthographicCamera`ï¼ˆæ­£äº¤æŠ•å½±ç›¸æœºï¼‰ä»–ä¸å…·æœ‰é€è§†æ•ˆæœï¼Œå³ç‰©ä½“çš„å¤§å°ä¸å—è¿œè¿‘è·ç¦»çš„å½±å“ï¼Œå¯¹åº”çš„æ˜¯æŠ•å½±ä¸­çš„æ­£äº¤æŠ•å½±ã€‚æˆ‘ä»¬æ•°å­¦è¯¾æœ¬ä¸Šæ‰€ç”»çš„å‡ ä½•ä½“å¤§å¤šæ•°éƒ½é‡‡ç”¨è¿™ç§æŠ•å½±ã€‚

å·¦ä¾§æ˜¯`PerspectiveCamera`ï¼ˆé€è§†ç›¸æœºï¼‰ï¼Œè¿™ç¬¦åˆæˆ‘ä»¬æ­£å¸¸äººçš„è§†é‡ï¼Œè¿‘å¤§è¿œå°ï¼Œå¯¹åº”çš„æ˜¯æŠ•å½±ä¸­çš„é€è§†æŠ•å½±ã€‚

å¦‚æœä½ æƒ³è®©åœºæ™¯çœ‹èµ·æ¥æ›´çœŸå®ï¼Œæ›´å…·æœ‰ç«‹ä½“æ„Ÿï¼Œé‚£ä¹ˆé‡‡ç”¨é€è§†ç›¸æœºæœ€åˆé€‚ï¼Œå¦‚æœåœºæ™¯ä¸­æœ‰ä¸€äº›å…ƒç´ ä½ ä¸æƒ³è®©ä»–éšç€è¿œè¿‘æ”¾å¤§ç¼©å°ï¼Œé‚£ä¹ˆé‡‡ç”¨æ­£äº¤æŠ•å½±ç›¸æœºæœ€åˆé€‚ã€‚

#### 2.4.2 æ„é€ å‚æ•°

æˆ‘ä»¬å†åˆ†åˆ«æ¥çœ‹çœ‹ä¸¤ä¸ªåˆ›å»ºä¸¤ä¸ªç›¸æœºéœ€è¦ä»€ä¹ˆå‚æ•°ï¼š

```js
_camera = new OrthographicCamera(left, right, top, bottom, near, far);
```


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836a8fb90171f~tplv-t2oaga2asx-image.image)

`OrthographicCamera`æ¥æ”¶å…­ä¸ªå‚æ•°ï¼Œ`left, right, top, bottom`åˆ†åˆ«å¯¹åº”ä¸Šã€ä¸‹ã€å·¦ã€å³ã€è¿œã€è¿‘çš„ä¸€ä¸ªè·ç¦»ï¼Œè¶…è¿‡è¿™äº›è·ç¦»çš„å…ƒç´ å°†ä¸ä¼šå‡ºç°åœ¨è§†é‡èŒƒå›´å†…ï¼Œä¹Ÿä¸ä¼šè¢«æµè§ˆå™¨ç»˜åˆ¶ã€‚å®é™…ä¸Šï¼Œè¿™å…­ä¸ªè·ç¦»å°±æ„æˆäº†ä¸€ä¸ªç«‹æ–¹ä½“ï¼Œæ‰€ä»¥`OrthographicCamera`çš„å¯è§†èŒƒå›´æ°¸è¿œåœ¨è¿™ä¸ªç«‹æ–¹ä½“å†…ã€‚

```js
_camera = new PerspectiveCamera(fov, aspect, near, far);
```


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836ac10f9ada9~tplv-t2oaga2asx-image.image)

`PerspectiveCamera`æ¥æ”¶å››ä¸ªå‚æ•°ï¼Œ`near`ã€`far`å’Œä¸Šé¢çš„ç›¸åŒï¼Œåˆ†åˆ«å¯¹åº”ç›¸æœºå¯è§‚æµ‹çš„æœ€è¿œå’Œæœ€è¿‘è·ç¦»ï¼›`fov`ä»£è¡¨æ°´å¹³èŒƒå›´å¯è§‚æµ‹çš„è§’åº¦ï¼Œ`fov`è¶Šå¤§ï¼Œæ°´å¹³èŒƒå›´èƒ½è§‚æµ‹åˆ°çš„èŒƒå›´è¶Šå¹¿ï¼›`aspect`ä»£è¡¨æ°´å¹³æ–¹å‘å’Œç«–ç›´æ–¹å‘å¯è§‚æµ‹è·ç¦»çš„æ¯”å€¼ï¼Œæ‰€ä»¥`fov`å’Œ`aspect`å°±å¯ä»¥ç¡®å®šå‚ç›´èŒƒå›´å†…èƒ½è§‚æµ‹åˆ°çš„èŒƒå›´ã€‚


#### 2.4.3 positionã€lookAt

å…³äºç›¸æœºè¿˜æœ‰ä¸¤ä¸ªå¿…é¡»è¦çŸ¥é“çš„ç‚¹ï¼Œä¸€ä¸ªæ˜¯`position`å±æ€§ï¼Œä¸€ä¸ªæ˜¯`lookAt`å‡½æ•°ï¼š

`position`å±æ€§æŒ‡å®šäº†ç›¸æœºæ‰€å¤„çš„ä½ç½®ã€‚

`lookAt`å‡½æ•°æŒ‡å®šç›¸æœºè§‚å¯Ÿçš„æ–¹å‘ã€‚

å®é™…ä¸Š`position`çš„å€¼å’Œ`lookAt`æ¥æ”¶çš„å‚æ•°éƒ½æ˜¯ä¸€ä¸ªç±»å‹ä¸º`Vector3`çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç”¨æ¥è¡¨ç¤ºä¸‰ç»´ç©ºé—´ä¸­çš„åæ ‡ï¼Œå®ƒæœ‰ä¸‰ä¸ªå±æ€§ï¼š`xã€yã€z`åˆ†åˆ«ä»£è¡¨è·ç¦»`x`è½´ã€è·ç¦»`y`è½´ã€è·ç¦»`z`è½´çš„è·ç¦»ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬è®©ç›¸æœºè§‚å¯Ÿçš„æ–¹å‘æŒ‡å‘åŸç‚¹ï¼Œå¦å¤–åˆ†åˆ«è®©`xã€yã€z`ä¸º0ï¼Œå¦å¤–ä¸¤ä¸ªå‚æ•°ä¸ä¸º0ï¼Œçœ‹ä¸€ä¸‹è§†é‡ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ï¼š

```js
_camera = new OrthographicCamera(-window.innerWidth / 2, window.innerWidth / 2, window.innerHeight / 2, -window.innerHeight / 2, 0.1, 1000);
 _camera.lookAt(new THREE.Vector3(0, 0, 0))

 _camera.position.set(0, 300, 600); // 1 - xä¸º0

 _camera.position.set(500, 0, 600); // 2 - yä¸º0

 _camera.position.set(500, 300, 0); // 3 - zä¸º0
```


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836aeeb1e1ce0~tplv-t2oaga2asx-image.image)

å¾ˆæ¸…æ¥šçš„çœ‹åˆ°`position`å†³å®šäº†æˆ‘ä»¬è§†é‡çš„å‡ºå‘ç‚¹ï¼Œä½†æ˜¯é•œå¤´æŒ‡å‘çš„æ–¹å‘æ˜¯ä¸å˜çš„ã€‚

ä¸‹é¢æˆ‘ä»¬å°†`position`å›ºå®šï¼Œæ”¹å˜ç›¸æœºè§‚å¯Ÿçš„æ–¹å‘ï¼š

```js
_camera = new OrthographicCamera(-window.innerWidth / 2, window.innerWidth / 2, window.innerHeight / 2, -window.innerHeight / 2, 0.1, 1000);
_camera.position.set(500, 300, 600); 

_camera.lookAt(new THREE.Vector3(0, 0, 0)) // 1 - è§†é‡æŒ‡å‘åŸç‚¹

_camera.lookAt(new THREE.Vector3(200, 0, 0)) // 2 - è§†é‡åå‘xè½´
```


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836b1dd3dd08d~tplv-t2oaga2asx-image.image)

å¯è§ï¼šæˆ‘ä»¬è§†é‡çš„å‡ºå‘ç‚¹æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯è§†é‡çœ‹å‘çš„æ–¹å‘å‘ç”Ÿäº†æ”¹å˜ã€‚


#### 2.4.4 ä¸¤ç§ç›¸æœºå¯¹æ¯”

å¥½ï¼Œæœ‰äº†ä¸Šé¢çš„åŸºç¡€ï¼Œæˆ‘ä»¬å†æ¥å†™ä¸¤ä¸ªä¾‹å­çœ‹ä¸€çœ‹ä¸¤ä¸ªç›¸æœºçš„è§†è§’å¯¹æ¯”ï¼Œä¸ºäº†æ–¹ä¾¿è§‚çœ‹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªä½ç½®ä¸åŒçš„å‡ ä½•ä½“ï¼š

```js
var geometry = new THREE.BoxGeometry(200, 100, 100);
var material = new THREE.MeshStandardMaterial({ color: 0x645d50 });
var mesh = new THREE.Mesh(geometry, material);
_scene.add(mesh);

var geometry = new THREE.SphereGeometry(50, 100, 100);
var ball = new THREE.Mesh(geometry, material);
ball.position.set(200, 0, -200);
_scene.add(ball);
```

æ­£äº¤æŠ•å½±ç›¸æœºè§†é‡ï¼š

```js
_camera = new OrthographicCamera(-window.innerWidth / 2, window.innerWidth / 2, window.innerHeight / 2, -window.innerHeight / 2, 0.1, 1000);
_camera.position.set(0, 300, 600);
_camera.lookAt(new THREE.Vector3(0, 0, 0))
```

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836b53b0008f0~tplv-t2oaga2asx-image.image)


é€è§†ç›¸æœºè§†é‡ï¼š

```js
_camera = new PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1100);
_camera.position.set(0, 300, 600);
_camera.lookAt(new THREE.Vector3(0, 0, 0))
```


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836b74e23018a~tplv-t2oaga2asx-image.image)

å¯è§ï¼Œè¿™å°è¯äº†æˆ‘ä»¬ä¸Šé¢[å…³äºä¸¤ç§ç›¸æœºçš„ç†è®º](#ä¸¤ç§ç›¸æœºçš„åŒºåˆ«)


### 2.5 æ¸²æŸ“å™¨

ä¸Šé¢æˆ‘ä»¬åˆ›å»ºäº†åœºæ™¯ã€å…ƒç´ å’Œç›¸æœºï¼Œä¸‹é¢æˆ‘ä»¬è¦å‘Šè¯‰æµè§ˆå™¨å°†è¿™äº›ä¸œè¥¿æ¸²æŸ“åˆ°æµè§ˆå™¨ä¸Šã€‚

`Three.js`ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å‡ ç§ä¸åŒçš„æ¸²æŸ“å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦çœ‹`WebGL`æ¸²æŸ“å™¨(`WebGLRenderer`)ã€‚é¡¾åæ€ä¹‰ï¼š`WebGL`æ¸²æŸ“å™¨ä½¿ç”¨`WebGL`æ¥ç»˜åˆ¶åœºæ™¯ï¼Œå…¶å¤Ÿåˆ©ç”¨`GPU`ç¡¬ä»¶åŠ é€Ÿä»è€Œæé«˜æ¸²æŸ“æ€§èƒ½ã€‚

```js
_renderer = new THREE.WebGLRenderer();
```

ä½ éœ€è¦å°†ä½ ä½¿ç”¨`Three.js`ç»˜åˆ¶çš„å…ƒç´ æ·»åŠ åˆ°æµè§ˆå™¨ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦ä¸€ä¸ªè½½ä½“ï¼Œä¸Šé¢æˆ‘ä»¬ä»‹ç»ï¼Œè¿™ä¸ªè½½ä½“å°±æ˜¯`Canvas`ï¼Œä½ å¯ä»¥é€šè¿‡`_renderer.domElement`è·å–åˆ°è¿™ä¸ª`Canvas`ï¼Œå¹¶å°†å®ƒç»™å®šåˆ°çœŸå®`DOM`ä¸­ã€‚

```js
 _container = document.getElementById('conianer');
 _container.appendChild(_renderer.domElement);
```

ä½¿ç”¨`setSize`å‡½æ•°è®¾å®šä½ è¦æ¸²æŸ“çš„èŒƒå›´ï¼Œå®é™…ä¸Šå®ƒæ”¹å˜çš„å°±æ˜¯ä¸Šé¢`Canvas`çš„èŒƒå›´ï¼š

```js
_renderer.setSize(window.innerWidth, window.innerHeight);
```

ç°åœ¨ï¼Œä½ å·²ç»æŒ‡å®šäº†ä¸€ä¸ªæ¸²æŸ“çš„è½½ä½“å’Œè½½ä½“çš„èŒƒå›´ï¼Œä½ å¯ä»¥é€šè¿‡`render`å‡½æ•°æ¸²æŸ“ä¸Šé¢æŒ‡å®šçš„åœºæ™¯å’Œç›¸æœºï¼š

```js
_renderer.render(_scene, _camera);
```

å®é™…ä¸Šï¼Œä½ å¦‚æœä¾æ¬¡æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œå¯èƒ½å±å¹•ä¸Šè¿˜æ˜¯é»‘æ¼†æ¼†çš„ä¸€ç‰‡ï¼Œå¹¶æ²¡æœ‰ä»»ä½•å…ƒç´ æ¸²æŸ“å‡ºæ¥ã€‚

è¿™æ˜¯å› ä¸ºä¸Šé¢ä½ è¦æ¸²æŸ“çš„å…ƒç´ å¯èƒ½å¹¶æœªè¢«åŠ è½½å®Œï¼Œä½ å°±æ‰§è¡Œäº†æ¸²æŸ“ï¼Œå¹¶ä¸”åªæ‰§è¡Œäº†ä¸€æ¬¡ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•ï¼Œè®©åœºæ™¯å’Œç›¸æœºè¿›è¡Œå®æ—¶æ¸²æŸ“ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸‹é¢çš„æ–¹æ³•ï¼š

### 2.6 requestAnimationFrame

`window.requestAnimationFrame()`å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚

è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œã€‚

```js
window.requestAnimationFrame(callback);
```

è‹¥ä½ æƒ³åœ¨æµè§ˆå™¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰ç»§ç»­æ›´æ–°ä¸‹ä¸€å¸§åŠ¨ç”»ï¼Œé‚£ä¹ˆå›è°ƒå‡½æ•°è‡ªèº«å¿…é¡»å†æ¬¡è°ƒç”¨`window.requestAnimationFrame()`ã€‚

ä½¿ç”¨è€…éŸ©å‡½æ•°å°±æ„å‘³ç€ï¼Œä½ å¯ä»¥åœ¨`requestAnimationFrame`ä¸åœçš„æ‰§è¡Œç»˜åˆ¶æ“ä½œï¼Œæµè§ˆå™¨å°±å®æ—¶çš„çŸ¥é“å®ƒéœ€è¦æ¸²æŸ“çš„å†…å®¹ã€‚

å½“ç„¶ï¼ŒæŸäº›æ—¶å€™ä½ å·²ç»ä¸éœ€è¦å®æ—¶ç»˜åˆ¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨`cancelAnimationFrame`ç«‹å³åœæ­¢è¿™ä¸ªç»˜åˆ¶ï¼š

```js
window.cancelAnimationFrame(myReq);
```

æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

```js
        var i = 0;
        var animateName;
        animate();
        function animate() {
            animateName = requestAnimationFrame(animate);
            console.log(i++);
            if (i > 100) {
                cancelAnimationFrame(animateName);
            }
        }
```

æ¥çœ‹ä¸€ä¸‹æ‰§è¡Œæ•ˆæœï¼š


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a8372c7276f810~tplv-t2oaga2asx-image.image)

æˆ‘ä»¬ä½¿ç”¨`requestAnimationFrame`å’Œ`Three.js`çš„æ¸²æŸ“å™¨ç»“åˆä½¿ç”¨ï¼Œè¿™æ ·å°±èƒ½å®æ—¶ç»˜åˆ¶ä¸‰ç»´åŠ¨ç”»äº†ï¼š

```js
        function animate() {
            requestAnimationFrame(animate);
            _renderer.render(_scene, _camera);
        }
```

å€ŸåŠ©ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•å®ç°ä¸€äº›åŠ¨ç”»æ•ˆæœï¼š

```js
        var y = 100;
        var option = 'down';
        function animateIn() {
            animateName = requestAnimationFrame(animateIn);
            mesh.rotateX(Math.PI / 40);
            if (option == 'up') {
                ball.position.set(200, y += 8, 0);
            } else {
                ball.position.set(200, y -= 8, 0);
            }
            if (y < 1) { option = 'up'; }
            if (y > 100) { option = 'down' }
        }
```


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836bc5deeafa3~tplv-t2oaga2asx-image.image)

### 2.7 æ€»ç»“

ä¸Šé¢çš„çŸ¥è¯†æ˜¯`Three.js`ä¸­æœ€åŸºç¡€çš„çŸ¥è¯†ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„å’Œæœ€ä¸»å¹²çš„ã€‚

è¿™äº›çŸ¥è¯†èƒ½å¤Ÿè®©ä½ åœ¨çœ‹åˆ°ä¸€ä¸ªå¤æ‚çš„ä¸‰ç»´æ•ˆæœæ—¶æœ‰ä¸€å®šçš„æ€è·¯ï¼Œå½“ç„¶ï¼Œè¦å®ç°è¿˜éœ€è¦éå¸¸å¤šçš„ç»†èŠ‚ã€‚è¿™äº›ç»†èŠ‚ä½ å¯ä»¥å»[å®˜æ–¹æ–‡æ¡£](https://threejs.org/docs/index.html#manual/en/introduction/Creating-a-scene)ä¸­æŸ¥é˜…ã€‚

ä¸‹é¢çš„ç« èŠ‚å³å‘Šè¯‰ä½ å¦‚ä½•ä½¿ç”¨`Three.js`è¿›è¡Œå®æˆ˜ â€” å®ç°ä¸€ä¸ª360åº¦å…¨æ™¯æ’ä»¶ã€‚

è¿™ä¸ªæ’ä»¶åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å¯¹å…¨æ™¯å›¾è¿›è¡Œé¢„è§ˆã€‚

ç¬¬äºŒéƒ¨åˆ†æ˜¯å¯¹å…¨æ™¯å›¾çš„æ ‡è®°è¿›è¡Œé…ç½®ï¼Œå¹¶å…³è”é¢„è§ˆçš„åæ ‡ã€‚

æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å…¨æ™¯é¢„è§ˆéƒ¨åˆ†ï¼š

## ä¸‰ã€å…¨æ™¯é¢„è§ˆ


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836cd0f7c13d8~tplv-t2oaga2asx-image.image)

### 3.1 åŸºæœ¬é€»è¾‘

- å°†ä¸€å¼ å…¨æ™¯å›¾åŒ…è£¹åœ¨çƒä½“çš„å†…å£

- è®¾å®šä¸€ä¸ªè§‚å¯Ÿç‚¹ï¼Œåœ¨çƒçš„åœ†å¿ƒ

- ä½¿ç”¨é¼ æ ‡å¯ä»¥æ‹–åŠ¨çƒä½“ï¼Œä»è€Œæ”¹å˜æˆ‘ä»¬çœ‹åˆ°å…¨æ™¯çš„è§†é‡

- é¼ æ ‡æ»šè½®å¯ä»¥ç¼©æ”¾ï¼Œå’Œæ”¾å¤§ï¼Œæ”¹å˜è§‚å¯Ÿå…¨æ™¯çš„è¿œè¿‘

- æ ¹æ®åæ ‡åœ¨å…¨æ™¯å›¾ä¸ŠæŒ‚è½½ä¸€äº›æ ‡è®°ï¼Œå¦‚æ–‡å­—ã€å›¾æ ‡ç­‰ï¼Œå¹¶ä¸”å¯ä»¥å¢åŠ äº‹ä»¶ï¼Œå¦‚ç‚¹å‡»äº‹ä»¶

### 3.2 åˆå§‹åŒ–

æˆ‘ä»¬å…ˆæŠŠå¿…è¦çš„åŸºç¡€è®¾æ–½æ­å»ºèµ·æ¥ï¼š

åœºæ™¯ã€ç›¸æœºï¼ˆé€‰æ‹©è¿œæ™¯ç›¸æœºï¼Œè¿™æ ·å¯ä»¥è®©å…¨æ™¯çœ‹èµ·æ¥æ›´çœŸå®ï¼‰ã€æ¸²æŸ“å™¨ï¼š

```js

_scene = new THREE.Scene();
initCamera();
initRenderer();
animate();

// åˆå§‹åŒ–ç›¸æœº
function initCamera() {
    _camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1100);
    _camera.position.set(0, 0, 2000);
    _camera.lookAt(new THREE.Vector3(0, 0, 0));
}

// åˆå§‹åŒ–æ¸²æŸ“å™¨
function initRenderer() {
    _renderer = new THREE.WebGLRenderer();
    _renderer.setSize(window.innerWidth, window.innerHeight);
    _container = document.getElementById('panoramaConianer');
    _container.appendChild(_renderer.domElement);
}

// å®æ—¶æ¸²æŸ“
function animate() {
    requestAnimationFrame(animate);
    _renderer.render(_scene, _camera);
}
```

ä¸‹é¢æˆ‘ä»¬åœ¨åœºæ™¯å†…æ·»åŠ ä¸€ä¸ªçƒä½“ï¼Œå¹¶æŠŠå…¨æ™¯å›¾ä½œä¸ºææ–™åŒ…è£¹åœ¨çƒä½“ä¸Šé¢ï¼š

```js
var mesh = new THREE.Mesh(new THREE.SphereGeometry(1000, 100, 100),
new THREE.MeshBasicMaterial(
        { map: ImageUtils.loadTexture('img/p3.png') }
    ));
_scene.add(mesh);
```

ç„¶åæˆ‘ä»¬çœ‹åˆ°çš„åœºæ™¯åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836d35a4833c9~tplv-t2oaga2asx-image.image)

è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯ä»çƒçš„å†…éƒ¨è§‚å¯Ÿå…¨æ™¯ï¼Œå¹¶ä¸”å…¨æ™¯å›¾æ˜¯é™„ç€å¤–çƒçš„å†…å£çš„ï¼Œè€Œä¸æ˜¯é“ºåœ¨å¤–é¢ï¼š

æˆ‘ä»¬åªè¦éœ€å°†`Material`çš„`scale`çš„ä¸€ä¸ªå±æ€§è®¾ç½®ä¸ºè´Ÿå€¼ï¼Œææ–™å³å¯é™„ç€åœ¨å‡ ä½•ä½“çš„å†…éƒ¨ï¼š

```js
 mesh.scale.x = -1;
```

ç„¶åæˆ‘ä»¬å°†ç›¸æœºçš„ä¸­å¿ƒç‚¹ç§»åŠ¨åˆ°çƒçš„ä¸­å¿ƒï¼š

```js
 _camera.position.set(0, 0, 0);
```

ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨å…¨æ™¯çƒçš„å†…éƒ¨å•¦ï¼š


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836db58b605ae~tplv-t2oaga2asx-image.image)


### 3.3 äº‹ä»¶å¤„ç†

å…¨æ™¯å›¾å·²ç»å¯ä»¥æµè§ˆäº†ï¼Œä½†æ˜¯ä½ åªèƒ½çœ‹åˆ°ä½ çœ¼å‰çš„è¿™ä¸€å—ï¼Œå¹¶ä¸èƒ½æ‹–åŠ¨å®ƒçœ‹åˆ°å…¶ä»–éƒ¨åˆ†ï¼Œä¸ºäº†ç²¾ç¡®çš„æ§åˆ¶æ‹–åŠ¨çš„é€Ÿåº¦å’Œç¼©æ”¾ã€æ”¾å¤§ç­‰åœºæ™¯ï¼Œæˆ‘ä»¬æ‰‹åŠ¨ä¸ºå®ƒå¢åŠ ä¸€äº›äº‹ä»¶ï¼š

ç›‘å¬é¼ æ ‡çš„`mousedown`äº‹ä»¶ï¼Œåœ¨æ­¤æ—¶å°†å¼€å§‹æ‹–åŠ¨æ ‡è®°`_isUserInteracting`è®¾ç½®ä¸º`true`ï¼Œå¹¶ä¸”è®°å½•èµ·å§‹çš„å±å¹•åæ ‡ï¼Œä»¥åŠèµ·å§‹çš„ç›¸æœº`lookAt`çš„åæ ‡ã€‚

```js
_container.addEventListener('mousedown', (event)=>{
  event.preventDefault();
  _isUserInteracting = true;
  _onPointerDownPointerX = event.clientX;
  _onPointerDownPointerY = event.clientY;
  _onPointerDownLon = _lon;
  _onPointerDownLat = _lat;
});
```

ç›‘å¬é¼ æ ‡çš„`mousemove`äº‹ä»¶ï¼Œå½“`_isUserInteracting`ä¸º`true`æ—¶ï¼Œå®æ—¶è®¡ç®—å½“å‰ç›¸æœº`lookAt`çš„çœŸå®åæ ‡ã€‚

```js
_container.addEventListener('mousemove', (event)=>{
  if (_isUserInteracting) {
    _lon = (_onPointerDownPointerX - event.clientX) * 0.1 + _onPointerDownLon;
    _lat = (event.clientY - _onPointerDownPointerY) * 0.1 + _onPointerDownLat;
  }
});
```
ç›‘å¬é¼ æ ‡çš„`mouseup`äº‹ä»¶ï¼Œå°†`_isUserInteracting`è®¾ç½®ä¸º`false`ã€‚

```js
_container.addEventListener('mouseup', (event)=>{
 _isUserInteracting = false;
});
```

å½“ç„¶ï¼Œä¸Šé¢æˆ‘ä»¬åªæ˜¯æ”¹å˜äº†åæ ‡ï¼Œå¹¶æ²¡æœ‰å‘Šè¯‰ç›¸æœºå®ƒæ”¹å˜äº†ï¼Œæˆ‘ä»¬åœ¨`animate`å‡½æ•°ä¸­æ¥åšè¿™ä»¶äº‹ï¼š

```js
function animate() {
  requestAnimationFrame(animate);
  calPosition();
  _renderer.render(_scene, _camera);
  _renderer.render(_sceneOrtho, _cameraOrtho);
}

function calPosition() {
  _lat = Math.max(-85, Math.min(85, _lat));
  var phi = tMath.degToRad(90 - _lat);
  var theta = tMath.degToRad(_lon);
  _camera.target.x = _pRadius * Math.sin(phi) * Math.cos(theta);
  _camera.target.y = _pRadius * Math.cos(phi);
  _camera.target.z = _pRadius * Math.sin(phi) * Math.sin(theta);
  _camera.lookAt(_camera.target);
}

```

ç›‘å¬`mousewheel`äº‹ä»¶ï¼Œå¯¹å…¨æ™¯å›¾è¿›è¡Œæ”¾å¤§å’Œç¼©å°ï¼Œæ³¨æ„è¿™é‡ŒæŒ‡å®šäº†æœ€å¤§ç¼©æ”¾èŒƒå›´`maxFocalLength`å’Œæœ€å°ç¼©æ”¾èŒƒå›´`minFocalLength`ã€‚

```js
_container.addEventListener('mousewheel', (event)=>{
  var ev = ev || window.event;
  var down = true;
  var m = _camera.getFocalLength();
  down = ev.wheelDelta ? ev.wheelDelta < 0 : ev.detail > 0;
  if (down) {
    if (m > minFocalLength) {
      m -= m * 0.05
      _camera.setFocalLength(m);
    }
  } else {
    if (m < maxFocalLength) {
      m += m * 0.05
      _camera.setFocalLength(m);
    }
  }
});
```
æ¥çœ‹ä¸€ä¸‹æ•ˆæœå§ï¼š


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836eb1c7dbbe5~tplv-t2oaga2asx-image.image)

### 3.4 å¢åŠ æ ‡è®°

åœ¨æµè§ˆå…¨æ™¯å›¾çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å¯¹æŸäº›ç‰¹æ®Šçš„ä½ç½®è¿›è¡Œä¸€äº›æ ‡è®°ï¼Œå¹¶ä¸”è¿™äº›æ ‡è®°å¯èƒ½é™„å¸¦ä¸€äº›äº‹ä»¶ï¼Œæ¯”å¦‚ä½ éœ€è¦ç‚¹å‡»ä¸€ä¸ªæ ‡è®°æ‰èƒ½åˆ°è¾¾ä¸‹ä¸€å¼ å…¨æ™¯å›¾ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨å…¨æ™¯ä¸­å¢åŠ æ ‡è®°ï¼Œä»¥åŠå¦‚ä½•ä¸ºè¿™äº›æ ‡è®°æ·»åŠ äº‹ä»¶ã€‚

æˆ‘ä»¬å¯èƒ½ä¸éœ€è¦è®©è¿™äº›æ ‡è®°éšç€è§†é‡çš„å˜åŒ–è€Œæ”¾å¤§å’Œç¼©å°ï¼ŒåŸºäºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨æ­£äº¤æŠ•å½±ç›¸æœºæ¥å±•ç°æ ‡è®°ï¼Œåªéœ€ç»™å®ƒä¸€ä¸ªå›ºå®šçš„è§‚å¯Ÿé«˜åº¦ï¼š

```js
  _cameraOrtho = new THREE.OrthographicCamera(-window.innerWidth / 2, window.innerWidth / 2, window.innerHeight / 2, -window.innerHeight / 2, 1, 10);
  _cameraOrtho.position.z = 10;
  _sceneOrtho = new Scene();
```

åˆ©ç”¨ç²¾çµææ–™(`SpriteMaterial`)æ¥å®ç°æ–‡å­—æ ‡è®°ï¼Œæˆ–è€…å›¾ç‰‡æ ‡è®°ï¼š

```js
// åˆ›å»ºæ–‡å­—æ ‡è®°
function createLableSprite(name) {
  const canvas = document.createElement('canvas');
  const context = canvas.getContext('2d');
  const metrics = context.measureText(name);
  const width = metrics.width * 1.5;
  context.font = "10px å®‹ä½“";
  context.fillStyle = "rgba(0,0,0,0.95)";
  context.fillRect(2, 2, width + 4, 20 + 4);
  context.fillText(name, 4, 20);
  const texture = new Texture(canvas);
  const spriteMaterial = new SpriteMaterial({ map: texture });
  const sprite = new Sprite(spriteMaterial);
  sprite.name = name;
  const lable = {
    name: name,
    canvas: canvas,
    context: context,
    texture: texture,
    sprite: sprite
  };
  _sceneOrtho.add(lable.sprite);
  return lable;
}
// åˆ›å»ºå›¾ç‰‡æ ‡è®°
function createSprite(position, url, name) {
  const textureLoader = new TextureLoader();
  const ballMaterial = new SpriteMaterial({
    map: textureLoader.load(url)
  });
  const sp = {
    pos: position,
    name: name,
    sprite: new Sprite(ballMaterial)
  };
  sp.sprite.scale.set(32, 32, 1.0);
  sp.sprite.name = name;
  _sceneOrtho.add(sp.sprite);
  return sp;
}
```

åˆ›å»ºå¥½è¿™äº›æ ‡è®°ï¼Œæˆ‘ä»¬æŠŠå®ƒæ¸²æŸ“åˆ°åœºæ™¯ä¸­ã€‚

æˆ‘ä»¬å¿…é¡»å‘Šè¯‰åœºæ™¯è¿™äº›æ ‡è®°çš„ä½ç½®ï¼Œä¸ºäº†ç›´è§‚çš„ç†è§£ï¼Œæˆ‘ä»¬éœ€è¦ç»™è¿™äº›æ ‡è®°èµ‹äºˆä¸€ç§åæ ‡ï¼Œè¿™ç§åæ ‡å¾ˆç±»ä¼¼äºç»çº¬åº¦ï¼Œæˆ‘ä»¬å«å®ƒ`lon`å’Œ`lat`ï¼Œå…·ä½“æ˜¯å¦‚ä½•ç»™å®šçš„æˆ‘ä»¬åœ¨ä¸‹é¢çš„ç« èŠ‚ï¼š[å…¨æ™¯æ ‡è®°](#å…¨æ™¯æ ‡è®°)ä¸­ä¼šè¯¦ç»†ä»‹ç»ã€‚

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸€å…±ç»å†äº†ä¸¤æ¬¡åæ ‡è½¬æ¢ï¼š

ç¬¬ä¸€æ¬¡è½¬æ¢ï¼šå°†â€œç»çº¬åº¦â€è½¬æ¢ä¸ºä¸‰ç»´ç©ºé—´åæ ‡ï¼Œå³æˆ‘ä»¬ä¸Šé¢è®²çš„é‚£ç§`xã€yã€z`å½¢å¼çš„åæ ‡ã€‚

ä½¿ç”¨`geoPosition2World`å‡½æ•°è¿›è¡Œè½¬æ¢ï¼Œå¾—åˆ°ä¸€ä¸ª`Vector3`å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†å½“å‰ç›¸æœº`_camera`ä½œä¸ºå‚æ•°ä¼ å…¥è¿™ä¸ªå¯¹è±¡çš„`project`æ–¹æ³•ï¼Œè¿™ä¼šå¾—åˆ°ä¸€ä¸ªæ ‡å‡†åŒ–åçš„åæ ‡ï¼ŒåŸºäºè¿™ä¸ªåæ ‡å¯ä»¥å¸®æˆ‘ä»¬åˆ¤æ–­æ ‡è®°æ˜¯å¦åœ¨è§†é‡èŒƒå›´å†…ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼Œè‹¥æ ‡å‡†åŒ–åæ ‡åœ¨`-1`å’Œ`1`çš„èŒƒå›´å†…ï¼Œåˆ™å®ƒä¼šå‡ºç°åœ¨æˆ‘ä»¬çš„è§†é‡ä¸­ï¼Œæˆ‘ä»¬å°†å®ƒè¿›è¡Œå‡†ç¡®æ¸²æŸ“ã€‚

ç¬¬äºŒæ¬¡è½¬æ¢ï¼šå°†ä¸‰ç»´ç©ºé—´åæ ‡è½¬æ¢ä¸ºå±å¹•åæ ‡ã€‚

å¦‚æœæˆ‘ä»¬ç›´æ¥è®²ä¸Šé¢çš„ä¸‰ç»´ç©ºé—´åæ ‡åæ ‡åº”ç”¨åˆ°æ ‡è®°ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ— è®ºè§†é‡å¦‚ä½•ç§»åŠ¨ï¼Œæ ‡è®°çš„ä½ç½®æ˜¯ä¸ä¼šæœ‰ä»»ä½•å˜åŒ–çš„ï¼Œå› ä¸ºè¿™æ ·ç®—å‡ºæ¥çš„åæ ‡æ°¸è¿œæ˜¯ä¸€ä¸ªå¸¸é‡ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸Šé¢çš„æ ‡å‡†åŒ–åæ ‡ï¼Œå°†æ ‡è®°çš„ä¸‰ç»´ç©ºé—´åæ ‡è½¬æ¢ä¸ºçœŸå®çš„å±å¹•åæ ‡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯`worldPostion2Screen`å‡½æ•°æ¥å®ç°çš„ã€‚

å…³äº`geoPosition2World`å’Œ`worldPostion2Screen`ä¸¤ä¸ªå‡½æ•°çš„å®ç°ï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥å»æˆ‘çš„`github`æºç ä¸­æŸ¥çœ‹ï¼Œè¿™é‡Œå°±ä¸å¤šåšè§£é‡Šäº†ï¼Œå› ä¸ºè¿™åˆè¦ç‰µæ‰¯åˆ°ä¸€å¤§å †ä¸“ä¸šçŸ¥è¯†å•¦ã€‚ğŸ˜…

```js
var wp = geoPosition2World(_sprites.lon, _sprites.lat);
var sp = worldPostion2Screen(wp, _camera);
var test = wp.clone();
test.project(_camera);
if (test.x > -1 && test.x < 1 && test.y > -1 && test.y < 1 && test.z > -1 && test.z < 1) {
    _sprites[i].sprite.scale.set(32, 32, 32);
    _sprites[i].sprite.position.set(sp.x, sp.y, 1);
}else {
    _sprites[i].sprite.scale.set(1.0, 1.0, 1.0);
    _sprites[i].sprite.position.set(0, 0, 0);
}
```


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a836f55784d0be~tplv-t2oaga2asx-image.image)

ç°åœ¨ï¼Œæ ‡è®°å·²ç»æ·»åŠ åˆ°å…¨æ™¯ä¸Šé¢äº†ï¼Œæˆ‘ä»¬æ¥ä¸ºå®ƒæ·»åŠ ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼š

`Three.js`å¹¶æ²¡æœ‰å•ç‹¬æä¾›ä¸º`Sprite`æ·»åŠ äº‹ä»¶çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©å…‰çº¿æŠ•å°„å™¨ï¼ˆ`Raycaster`ï¼‰æ¥å®ç°ã€‚

`Raycaster`æä¾›äº†é¼ æ ‡æ‹¾å–çš„èƒ½åŠ›ï¼š

é€šè¿‡`setFromCamera`å‡½æ•°æ¥å»ºç«‹å½“å‰ç‚¹å‡»çš„åæ ‡ï¼ˆç»è¿‡å½’ä¸€åŒ–å¤„ç†ï¼‰å’Œç›¸æœºçš„ç»‘å®šå…³ç³»ã€‚

é€šè¿‡`intersectObjects`æ¥åˆ¤å®šä¸€ç»„å¯¹è±¡ä¸­æœ‰å“ªäº›è¢«å‘½ä¸­ï¼ˆç‚¹å‡»ï¼‰ï¼Œå¾—åˆ°è¢«å‘½ä¸­çš„å¯¹è±¡æ•°ç»„ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°ç‚¹å‡»çš„å¯¹è±¡ï¼Œå¹¶åŸºäºå®ƒåšä¸€äº›å¤„ç†ï¼š

```js
_container.addEventListener('click', (event)=>{
  _mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
  _mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
  _raycaster.setFromCamera(_mouse, _cameraOrtho);
  var intersects = _raycaster.intersectObjects(_clickableObjects);
  intersects.forEach(function (element) {
    alert("ç‚¹å‡»åˆ°äº†: " + element.object.name);
  });
});
```

ç‚¹å‡»åˆ°ä¸€ä¸ªæ ‡è®°ï¼Œè¿›å…¥åˆ°ä¸‹ä¸€å¼ å…¨æ™¯å›¾ï¼š


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a8370006cc7b03~tplv-t2oaga2asx-image.image)

## å››ã€å…¨æ™¯æ ‡è®°

ä¸ºäº†è®©å…¨æ™¯å›¾çŸ¥é“ï¼Œæˆ‘è¦æŠŠæ ‡è®°æ ‡æ³¨åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªå·¥å…·æ¥æŠŠåŸå›¾å’Œå…¨æ™¯å›¾ä¸Šçš„ä½ç½®å…³è”èµ·æ¥ï¼š


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a837094deca180~tplv-t2oaga2asx-image.image)
ç”±äºè¿™éƒ¨åˆ†ä»£ç å’Œ`Three.js`å…³ç³»ä¸å¤§ï¼Œè¿™é‡Œæˆ‘åªè¯´ä¸€ä¸‹åŸºæœ¬çš„å®ç°é€»è¾‘ï¼Œæœ‰å…´è¶£å¯ä»¥å»æˆ‘çš„`github`ä»“åº“æŸ¥çœ‹ã€‚

### 4.1 è¦æ±‚

- å»ºç«‹åæ ‡å’Œå…¨æ™¯çš„æ˜ å°„å…³ç³»ï¼Œä¸ºå…¨æ™¯èµ‹äºˆä¸€å¥—è™šæ‹Ÿåæ ‡

- åœ¨ä¸€å¼ å¹³é“ºçš„å…¨æ™¯å›¾ä¸Šï¼Œå¯ä»¥åœ¨ä»»æ„ä½ç½®å¢åŠ æ ‡è®°ï¼Œå¹¶è·å–æ ‡è®°çš„åæ ‡

- ä½¿ç”¨åæ ‡åœ¨é¢„è§ˆå…¨æ™¯å¢åŠ æ ‡è®°ï¼Œçœ‹åˆ°çš„æ ‡è®°ä½ç½®å’Œå¹³é“ºå…¨æ™¯ä¸­çš„ä½ç½®ç›¸åŒ


### 4.2 åæ ‡

åœ¨`2D`å¹³é¢ä¸Šï¼Œæˆ‘ä»¬èƒ½ç›‘å¬å±å¹•çš„é¼ æ ‡äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è·å–çš„ä¹Ÿåªæ˜¯å½“å‰çš„é¼ æ ‡åæ ‡ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯å°†é¼ æ ‡åæ ‡è½¬æ¢æˆä¸‰ç»´ç©ºé—´åæ ‡ã€‚

çœ‹èµ·æ¥å¥½åƒæ˜¯ä¸å¯èƒ½çš„ï¼ŒäºŒç»´åæ ‡æ€ä¹ˆèƒ½è½¬æ¢æˆä¸‰ç»´åæ ‡å‘¢ï¼Ÿ

ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä¸€ç§ä¸­é—´åæ ‡æ¥è½¬æ¢ï¼Œå¯ä»¥æŠŠå®ƒç§°ä¹‹ä¸ºâ€œç»çº¬åº¦â€ã€‚

åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æˆ‘ä»¬å¸¸è¯´çš„ç»çº¬åº¦åˆ°åº•æ˜¯ä»€ä¹ˆã€‚

### 4.3 ç»çº¬åº¦

ä½¿ç”¨ç»çº¬åº¦ï¼Œå¯ä»¥ç²¾ç¡®çš„å®šä½åˆ°åœ°çƒä¸Šä»»æ„ä¸€ä¸ªç‚¹ï¼Œå®ƒçš„è®¡ç®—è§„åˆ™æ˜¯è¿™æ ·çš„ï¼š


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a83714f0875913~tplv-t2oaga2asx-image.image)

é€šå¸¸æŠŠè¿æ¥å—æåˆ°åŒ—æçš„çº¿å«åšå­åˆçº¿ä¹Ÿå«ç»çº¿ï¼Œå…¶æ‰€å¯¹åº”çš„é¢å«åšå­åˆé¢ï¼Œè§„å®šè‹±å›½ä¼¦æ•¦æ ¼æ—å°¼æ²»å¤©æ–‡å°åŸå€çš„é‚£æ¡ç»çº¿ç§°ä¸º0Â°ç»çº¿ï¼Œä¹Ÿå«æœ¬åˆå­åˆçº¿å…¶å¯¹åº”çš„é¢å³æœ¬åˆå­åˆé¢ã€‚

ç»åº¦ï¼šçƒé¢ä¸ŠæŸåº—å¯¹åº”çš„å­åˆé¢ä¸æœ¬åˆå­åˆé¢é—´çš„å¤¹è§’ã€‚ä¸œæ­£è¥¿è´Ÿã€‚

çº¬åº¦ ï¼šçƒé¢ä¸ŠæŸç‚¹çš„æ³•çº¿ï¼ˆä»¥è¯¥åº—ä½œä¸ºåˆ‡ç‚¹ä¸çƒé¢ç›¸åˆ‡çš„é¢çš„æ³•çº¿ï¼‰ä¸èµ¤é“å¹³é¢çš„å¤¹è§’ã€‚åŒ—æ­£å—è´Ÿã€‚

ç”±æ­¤ï¼Œåœ°çƒä¸Šæ¯ä¸€ä¸ªç‚¹éƒ½èƒ½è¢«å¯¹åº”åˆ°ä¸€ä¸ªç»åº¦å’Œçº¬åº¦ï¼Œæƒ³å¯¹åº”çš„ï¼Œä¹Ÿèƒ½å¯¹åº”åˆ°æŸæ¡ç»çº¿å’Œçº¬çº¿ä¸Šã€‚

è¿™æ ·ï¼Œå³ä½¿æŠŠçƒé¢å±•å¼€ç§°å¹³é¢ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½ç”¨ç»çº¬åº¦è¡¨ç¤ºæŸåº—ç‚¹çš„ä½ç½®ï¼š


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a8371a08c11ba5~tplv-t2oaga2asx-image.image)

### 4.4 åæ ‡è½¬æ¢

åŸºäºä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ç»™å¹³é¢çš„å…¨æ™¯å›¾èµ‹äºˆä¸€ä¸ªè™šæ‹Ÿçš„â€œç»çº¬åº¦â€ã€‚æˆ‘ä»¬ä½¿ç”¨`Canvas`ä¸ºå®ƒç»˜åˆ¶ä¸€å¼ "ç»çº¬ç½‘"ï¼š


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/5/4/16a83725d6ac6e7b~tplv-t2oaga2asx-image.image)

å°†é¼ æ ‡åæ ‡è½¬æ¢ä¸º"ç»çº¬åº¦"ï¼š

```js
function calLonLat(e) {
  var h = _setContainer.style.height.split("px")[0];
  var w = _setContainer.style.width.split("px")[0];
  var ix = _setContainer.offsetLeft;
  var iy = _setContainer.offsetTop;
  iy = iy + h;
  var x = e.clientX;
  var y = e.clientY;
  var lonS = (x - ix) / w;
  var lon = 0;
  if (lonS > 0.5) {
    lon = -(1 - lonS) * 360;
  } else {
    lon = 1 * 360 * lonS;
  }
  var latS = (iy - y) / h;
  var lat = 0;
  if (latS > 0.5) {
    lat = (latS - 0.5) * 180;
  } else {
    lat = (0.5 - latS) * 180 * -1
  }
  lon = lon.toFixed(2);
  lat = lat.toFixed(2);
  return { lon: lon, lat: lat };
}

```

è¿™æ ·å¹³é¢åœ°å›¾ä¸Šçš„æŸç‚¹å°±å¯ä»¥å’Œä¸‰ç»´åæ ‡å…³è”èµ·æ¥äº†ï¼Œå½“ç„¶ï¼Œè¿™è¿˜éœ€è¦ä¸€å®šçš„è½¬æ¢ï¼Œæœ‰å…´è¶£å¯ä»¥å»æºç ç ”ç©¶ä¸‹`geoPosition2World`å’Œ`worldPostion2Screen`ä¸¤ä¸ªå‡½æ•°ã€‚

## äº”ã€æ’ä»¶å°è£…

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†å…¨æ™¯é¢„è§ˆå’Œå…¨æ™¯æ ‡è®°çš„åŠŸèƒ½ï¼Œä¸‹é¢ï¼Œæˆ‘ä»¬è¦æŠŠè¿™äº›åŠŸèƒ½å°è£…æˆæ’ä»¶ã€‚

æ‰€è°“æ’ä»¶ï¼Œå³å¯ä»¥ç›´æ¥å¼•ç”¨ä½ å†™çš„ä»£ç ï¼Œå¹¶æ·»åŠ å°‘é‡çš„é…ç½®å°±å¯ä»¥å®ç°æƒ³è¦çš„åŠŸèƒ½ã€‚


### 5.1 å…¨æ™¯é¢„è§ˆå°è£…

æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œç©¶ç«Ÿå“ªäº›é…ç½®æ˜¯å¯ä»¥æŠ½å–å‡ºæ¥çš„ï¼š

```js
var options = {
  container: 'panoramaConianer',
  url: 'resources/img/panorama/pano-7.jpg',
  lables: [],
  widthSegments: 60,
  heightSegments: 40,
  pRadius: 1000,
  minFocalLength: 1,
  maxFocalLength: 100,
  sprite: 'label',
  onClick: () => { }
}
```

- `container`:`dom`å®¹å™¨çš„`id`
- `url`:å›¾ç‰‡è·¯å¾„
- `lables`:å…¨æ™¯ä¸­çš„æ ‡è®°æ•°ç»„ï¼Œæ ¼å¼ä¸º` {position:{lon:114,lat:38},logoUrl:'lableLogo.png',text:'name'}`
- `widthSegments`:æ°´å¹³åˆ‡æ®µæ•°
- `heightSegments`:å‚ç›´åˆ‡æ®µæ•°ï¼ˆå€¼å°ç²—ç³™é€Ÿåº¦å¿«ï¼Œå€¼å¤§ç²¾ç»†é€Ÿåº¦æ…¢ï¼‰
- `pRadius`:å…¨æ™¯çƒçš„åŠå¾„ï¼Œæ¨èä½¿ç”¨é»˜è®¤å€¼
- `minFocalLength`:é•œå¤´æœ€å°æ‹‰è¿‘è·ç¦»
- `maxFocalLength`:é•œå¤´æœ€å¤§æ‹‰è¿‘è·ç¦»
- `sprite`:å±•ç¤ºçš„æ ‡è®°ç±»å‹`label,icon`
- `onClick`:æ ‡è®°çš„ç‚¹å‡»äº‹ä»¶

ä¸Šé¢çš„é…ç½®æ˜¯å¯ä»¥ç”¨æˆ·é…ç½®çš„ï¼Œé‚£ä¹ˆç”¨æˆ·è¯¥å¦‚ä½•ä¼ å…¥æ’ä»¶å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥åœ¨æ’ä»¶ä¸­å£°æ˜ä¸€äº›é»˜è®¤é…ç½®`options`ï¼Œç”¨æˆ·ä½¿ç”¨æ„é€ å‡½æ•°ä¼ å…¥å‚æ•°ï¼Œç„¶åä½¿ç”¨`Object.assign`å°†ä¼ å…¥é…ç½®è¦†ç›–åˆ°é»˜è®¤é…ç½®ã€‚

æ¥ä¸‹æ¥ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨`this.def`æ¥è®¿é—®è¿™äº›å˜é‡äº†ï¼Œç„¶ååªéœ€è¦æŠŠå†™æ­»çš„ä»£ç æ”¹æˆè¿™äº›é…ç½®å³å¯ã€‚

```js
options = {
    // é»˜è®¤é…ç½®...
}

function tpanorama(opt) {
  this.render(opt);
}

tpanorama.prototype = {
  constructor: this,
  def: {},
  render: function (opt) {
    this.def = Object.assign(options, opt);
    // åˆå§‹åŒ–æ“ä½œ...
  }
}
```

### 5.2 å…¨æ™¯æ ‡è®°å°è£…

åŸºæœ¬é€»è¾‘å’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œä¸‹é¢æ˜¯æå–å‡ºæ¥çš„ä¸€äº›å‚æ•°ã€‚

```js
var setOpt = {
  container: 'myDiv',//settingå®¹å™¨
  imgUrl: 'resources/img/panorama/3.jpg',
  width: '',//æŒ‡å®šå®½åº¦ï¼Œé«˜åº¦è‡ªé€‚åº”
  showGrid: true,//æ˜¯å¦æ˜¾ç¤ºæ ¼ç½‘
  showPosition: true,//æ˜¯å¦æ˜¾ç¤ºç»çº¬åº¦æç¤º
  lableColor: '#9400D3',//æ ‡è®°é¢œè‰²
  gridColor: '#48D1CC',//æ ¼ç½‘é¢œè‰²
  lables: [],//æ ‡è®°   {lon:114,lat:38,text:'æ ‡è®°ä¸€'}
  addLable: true,//å¼€å¯ååŒå‡»æ·»åŠ æ ‡è®°  (å¿…é¡»å¼€å¯ç»çº¬åº¦æç¤º)
  getLable: true,//å¼€å¯åå³é”®æŸ¥è¯¢æ ‡è®°  (å¿…é¡»å¼€å¯ç»çº¬åº¦æç¤º)
  deleteLbale: true,//å¼€å¯é»˜è®¤ä¸­é”®åˆ é™¤ ï¼ˆå¿…é¡»å¼€å¯ç»çº¬åº¦æç¤ºï¼‰
}
```
## å…­ã€å‘å¸ƒ

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¥½è€ƒè™‘å¦‚ä½•å°†å†™å¥½çš„æ’ä»¶è®©ç”¨æˆ·ä½¿ç”¨äº†ã€‚

æˆ‘ä»¬ä¸»è¦è€ƒè™‘ä¸¤ç§åœºæ™¯ï¼Œç›´æ¥å¼•ç”¨å’Œ`npm install`

### 6.1 ç›´æ¥å¼•ç”¨`JS`

ä¸ºäº†ä¸æ±¡æŸ“å…¨å±€å˜é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°`(function(){}())`å°†ä»£ç åŒ…èµ·æ¥ï¼Œç„¶åå°†æˆ‘ä»¬å†™å¥½çš„æ’ä»¶æš´éœ²ç»™å…¨å±€å˜é‡`window`ã€‚

æˆ‘æŠŠå®ƒæ”¾åœ¨`originSrc`ç›®å½•ä¸‹ã€‚

```js
(function (global, undefined) {

    function tpanorama(opt) {
        // ...
    }

    tpanorama.prototype = {
        // ...
    }

    function tpanoramaSetting(opt) {
        // ...
    }

    tpanoramaSetting.prototype = {
        // ...
    }

    global.tpanorama = tpanorama;
    global.tpanoramaSetting = panoramaSetting;
}(window))
```

### 6.2 ä½¿ç”¨`npm install`

ç›´æ¥å°†å†™å¥½çš„æ’ä»¶å¯¼å‡ºï¼š

```js
module.exports = tpanorama;
module.exports = panoramaSetting;
```

æˆ‘æŠŠå®ƒæ”¾åœ¨`src`ç›®å½•ä¸‹ã€‚

åŒæ—¶ï¼Œæˆ‘ä»¬è¦æŠŠ`package.json`ä¸­çš„`main`å±æ€§æŒ‡å‘æˆ‘ä»¬è¦å¯¼å‡ºçš„æ–‡ä»¶ï¼š`"main": "lib/index.js"`ï¼Œç„¶åå°†`name`ã€`description`ã€`version`ç­‰ä¿¡æ¯è¡¥å……å®Œæ•´ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å‘å¸ƒäº†ï¼Œé¦–å…ˆä½ è¦æœ‰ä¸€ä¸ª`npm`è´¦å·ï¼Œå¹¶ä¸”ç™»é™†ï¼Œå¦‚æœä½ æ²¡æœ‰è´¦å·ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªè´¦å·ã€‚

```js
npm adduser --registry http://registry.npmjs.org
```

å¦‚æœä½ å·²ç»æœ‰è´¦å·äº†ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œç™»é™†ã€‚

```js
npm login --registry http://registry.npmjs.org
```

ç™»é™†æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥å‘å¸ƒäº†ï¼š

```js
npm publish --registry http://registry.npmjs.org
```

æ³¨æ„ï¼Œä¸Šé¢æ¯ä¸ªå‘½ä»¤æˆ‘éƒ½æ‰‹åŠ¨æŒ‡å®šäº†`registry`ï¼Œè¿™æ˜¯å› ä¸ºå½“å‰ä½ ä½¿ç”¨çš„`npm`æºå¯èƒ½å·²ç»è¢«æ›´æ¢äº†ï¼Œå¯èƒ½ä½¿ç”¨çš„æ˜¯æ·˜å®æºæˆ–è€…å…¬å¸æºï¼Œè¿™æ—¶ä¸æ‰‹åŠ¨æŒ‡å®šä¼šå¯¼è‡´å‘å¸ƒå¤±è´¥ã€‚

å‘å¸ƒæˆåŠŸåç›´æ¥åœ¨[`npmå®˜ç½‘`](https://www.npmjs.com/package/tpanorama)ä¸Šçœ‹åˆ°ä½ çš„åŒ…äº†ã€‚

ç„¶åï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨`npm install tpanorama`è¿›è¡Œå®‰è£…ï¼Œç„¶åè¿›è¡Œä½¿ç”¨ï¼š

```js
var { tpanorama,tpanoramaSetting } = require('tpanorama');
```

### 6.3 babelç¼–è¯‘

æœ€åä¸è¦å¿˜äº†ï¼Œæ— è®ºä½¿ç”¨ä»¥ä¸Šå“ªç§æ–¹å¼ï¼Œæˆ‘ä»¬éƒ½è¦ä½¿ç”¨`babel`ç¼–è¯‘åæ‰èƒ½æš´éœ²ç»™ç”¨æˆ·ã€‚

åœ¨`scripts`ä¸­åˆ›å»ºä¸€ä¸ª`build`å‘½ä»¤ï¼Œå°†æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œæœ€ç»ˆæš´éœ²ç»™ç”¨æˆ·ä½¿ç”¨çš„å°†æ˜¯`lib`å’Œ`origin`ã€‚

```js
"build": "babel src --out-dir lib && babel originSrc --out-dir origin",
```

ä½ è¿˜å¯ä»¥æŒ‡å®šä¸€äº›å…¶ä»–çš„å‘½ä»¤æ¥ä¾›ç”¨æˆ·æµ‹è¯•ï¼Œå¦‚æˆ‘å°†å†™å¥½çš„ä¾‹å­å…¨éƒ¨æ”¾åœ¨`examples`ä¸­ï¼Œç„¶ååœ¨`scripts`å®šä¹‰äº†`expamle`å‘½ä»¤ï¼š

```js
"example": "npm run webpack && node ./server/www"
```

è¿™æ ·ï¼Œç”¨æˆ·å°†ä»£ç å…‹éš†åç›´æ¥åœ¨æœ¬åœ°è¿è¡Œ`npm run example`å°±å¯ä»¥è¿›è¡Œè°ƒè¯•äº†ã€‚

## ä¸ƒã€å°ç»“

æœ¬é¡¹ç›®çš„`github`åœ°å€ï¼šhttps://github.com/ConardLi/tpanorama


å¦‚æœä½ æƒ³åŠ å…¥é«˜è´¨é‡å‰ç«¯äº¤æµç¾¤ï¼Œæˆ–è€…ä½ æœ‰ä»»ä½•å…¶ä»–äº‹æƒ…æƒ³å’Œæˆ‘äº¤æµä¹Ÿå¯ä»¥æ·»åŠ æˆ‘çš„ä¸ªäººå¾®ä¿¡ [ConardLi](https://mp.weixin.qq.com/s?__biz=Mzk0MDMwMzQyOA==&mid=2247493407&idx=1&sn=41b8782a3bdc75b211206b06e1929a58&chksm=c2e11234f5969b22a0d7fd50ec32be9df13e2caeef186b30b5d653836b0725def8ccd58a56cf#rd) ã€‚